!function($){var btn_html='<a href="javascript:void(0)" class="l-btn l-btn-plain l-btn-disabled"><span class="l-btn-left"><span class="l-btn-text"><span class="l-btn-empty $btn_action">&nbsp;</span></span></span></a>',func=function(options,value){if(this.methods={view:this,parseValue:function(t){return isFunction(t)?t.apply(this,[]):t},renderFilter:function(t){var a=this.view.options,e=$("<tr class='dlv-filter'/>");if(t.append(e),this.filterTR=e,null!=a.rowCount){var i=$("<td/>");i.css({width:a.rowCount.width});var s=$("<div class='dlv-cell' style='text-align:center'>"+$.fn.datalistview.defaults.filterText+"</div>");i.append(s),e.append(i)}for(var n=0;n<a.columns.length;n++){var i=$("<td/>");i.css({width:a.columns[n].width});var s=$("<div class='dlv-cell'/>");i.append(s);var o=a.columns[n].id,l=a.filterSet[o];if(null!=l){var d=$.fn.datalistview.defaults.filterText;isString(l.tip)&&(d=l.tip);var p="";if(l.hasOwnProperty("value")&&(p=l.value),"text"==l.type){var r=function(t){if(13==t.keyCode){var a=$(this).attr("oldValue"),e=$(this).val();if(e!=a){$.data(this,"data").object.reload(!0)}$(this).attr("oldValue",e)}},c=$("<input title='"+d+"' value='"+p+"' type='text'/>").keypress(r).attr("filterName",o);$.data(c.get(0),"data",{object:this}),s.append(c)}else if("list"==l.type){for(var v=$("<select title='"+d+"'/>").change(function(t){$.data(this,"data").object.reload(!0)}).append($("<option value=''></option>")).attr("filterName",o),g=0;g<l.values.length;g++){var h=l.values[g],u=p===h.value?"selected":"",f=$("<option "+u+" value='"+h.value+"'>"+h.title+"</option>");v.append(f)}$.data(v.get(0),"data",{object:this}),s.append(v)}}e.append(i)}},deselect:function(t){if(!1!==this.view.options.canselect){var a=$.data(this.view.get(0),"data");$(a.view).find(".dlv-row.dlv-row-selected").each(function(){var e=$.data($(this).get(0),"data");for(var i in t){var s=t[i];if(e.value[a.source.keyid]==s){$(this).removeClass("dlv-row-selected");for(var n in a.selected)if(a.selected[n][a.source.keyid]==s){a.selected.splice(n,1);break}var o=$(this).find("input");o.length>0&&(o.get(0).checked=!1)}}}),this.updateSelection()}},select:function(t){if(!1!==this.view.options.canselect){var a=$.data(this.view.get(0),"data");!0!==t&&!1!==t||(a.selected=[]),1==this.view.options.multi&&$(a.view).find(".dlv-row").each(function(){if(!0===t){var e=$.data($(this).get(0),"data");$(this).addClass("dlv-row-selected"),a.selected.push(e.value);var i=$(this).find("input");i.length>0&&(i.get(0).checked=!0)}else if(!1===t){$(this).removeClass("dlv-row-selected");var i=$(this).find("input");i.length>0&&(i.get(0).checked=!1)}else{var e=$.data($(this).get(0),"data");for(var s in t){var n=t[s];if(e.value[a.source.keyid]==n){$(this).addClass("dlv-row-selected"),a.selected.push(e.value);var i=$(this).find("input");i.length>0&&(i.get(0).checked=!0)}}}}),this.updateSelection()}},renderHeader:function(){var t=this.view.options,a=$("<div style='width: 100%'/>"),e=$("<div/>");a.append(e),t.maxHeight>0&&e.css({"margin-right":"16px"});var i=$('<table cellpadding="0" cellspacing="0" style="width: 100%"/>');if(t.maxHeight>0&&i.css({"table-layout":"fixed"}),e.append(i),inArray(t.viewstyles,"list")&&isObject(t.filterSet)){var s=0;for(var n in t.filterSet){s=1;break}s>0&&this.renderFilter(i)}var o=$("<tr class='dlv-header'/>");if(i.append(o),null!=t.rowCount){var l=$("<td class='dlv-cell'/>");l.css({width:t.rowCount.width});var d=$("<div/>");d.css({"text-align":t.rowCount.align});var p=$("<div>"+t.rowCount.title+"</div>");if(d.append(p),!1!==t.canselect&&1==t.multi){var r=$("<input type='checkbox'/>").css({padding:0,margin:1}).click(function(t){$.data(this,"data").object.select(this.checked)});$.data(r.get(0),"data",{object:this}),p.prepend(r)}l.append(d),o.append(l)}for(var c=0;c<t.columns.length;c++){var l=$("<td class='dlv-cell'/>"),v=t.columns[c];isNotEmpty(v.headHover)||(v.headHover=!1),1==v.headHover&&l.mouseover(function(t){$(this).addClass("dlv-header-over")}).mouseout(function(t){$(this).removeClass("dlv-header-over")}),isNotEmpty(v.sortAble)||(v.sortAble=!1),isNotEmpty(v.align)||(v.align="left"),$.data(l.get(0),"data",{index:c,object:this});var d=$("<div />");d.css({"text-align":v.align}),isNotEmpty(v.width)&&(d.css({}),l.css({width:v.width}));var p=$("<div>"+v.title+"</div>"),g=$("<span><span class='dlv-sort-icon'></span></span>");if(isNotEmpty(this.sortSpan)||(this.sortSpan=[]),this.sortSpan.push(g),p.append(g),d.append(p),l.append(d),t.columns[c].sortAble){var h=function(t){var a=$.data(this,"data"),e=a.object.view.options,i=e.columns[a.index],s=[],n=e.sortSet.length;if(isNotEmpty(e.multiSort)&&0==e.multiSort){n>0&&i.id!=e.sortSet[0].id&&(n=0),n=n>1?1:n;for(var o=0;o<a.object.sortSpan.length;o++)a.object.sortSpan[o].removeClass("dlv-sort-asc").removeClass("dlv-sort-desc")}for(var l="",d=null,p=0;p<n;p++)l=e.sortSet[p].sort,i.id==e.sortSet[p].id&&(l="asc"==l?"desc":"desc"==l?"":"asc",d=l),""!=l&&s.push({id:e.sortSet[p].id,sort:l});null==d&&(d="asc",s.push({id:i.id,sort:d})),e.sortSet=s;var r=$($(this).find("div span").get(0)).removeClass("dlv-sort-asc").removeClass("dlv-sort-desc");""!=d&&r.addClass("dlv-sort-"+d),i.sort=l,a.object.reload()};l.click(h).css({cursor:"pointer"});var u=t.sortSet.length;isNotEmpty(t.multiSort)&&0==t.multiSort&&(u=u>1?1:u);for(var f=0;f<u;f++)if(t.columns[c].id==t.sortSet[f].id){$(p.find("span").get(0)).addClass("dlv-sort-"+t.sortSet[f].sort);break}}o.append(l)}return a},renderPager:function(){var t=this.view.options;if(isNotEmpty(t.pagination.pageDiv)&&(this.view.pageDiv=this.renderTopPageDiv(1),$(t.pagination.pageDiv).addClass("pageContainer").append(this.view.pageDiv)),isNotEmpty(t.pagination.pageDiv1)&&(this.view.pageDiv1=this.renderTopPageDiv(2),$(t.pagination.pageDiv1).addClass("pageContainer").append(this.view.pageDiv1)),isNotEmpty(t.pagination.pageInfo)){var a=$("<div/>");if(this.view.infoDiv=$("<span/>"),a.append(this.view.infoDiv),2==t.viewstyles.length){var e=function(t){if(!$(this).hasClass("l-btn-disabled")){$.data(this,"data").object.toggleViewStyle("list")}},i=$(btn_html.replace("$btn_action","icon-list")).click(e);this.btn_list=[i],"tile"==t.viewstyle&&i.removeClass("l-btn-disabled"),$.data(i.get(0),"data",{object:this});var e=function(t){if(!$(this).hasClass("l-btn-disabled")){$.data(this,"data").object.toggleViewStyle("tile")}},s=$(btn_html.replace("$btn_action","icon-tile")).click(e);this.btn_tile=[s],"list"==t.viewstyle&&s.removeClass("l-btn-disabled"),$.data(s.get(0),"data",{object:this}),a.append(i),a.append(s)}isString(t.pagination.pageInfo)?$(t.pagination.pageInfo).append(a):(this.view.infoDiv.css({float:"right"}),this.view.pageDiv.append(a))}if(isNotEmpty(t.pagination.pageInfo1)&&isString(t.pagination.pageInfo1)){var a=$("<div/>");if(this.view.infoDiv1=$("<span/>"),a.append(this.view.infoDiv1),2==t.viewstyles.length){var e=function(t){if(!$(this).hasClass("l-btn-disabled")){$.data(this,"data").object.toggleViewStyle("list")}},i=$(btn_html.replace("$btn_action","icon-list")).click(e);this.btn_list.push(i),"view"==t.viewstyle&&i.removeClass("l-btn-disabled"),$.data(i.get(0),"data",{object:this});var e=function(t){if(!$(this).hasClass("l-btn-disabled")){$.data(this,"data").object.toggleViewStyle("tile")}},s=$(btn_html.replace("$btn_action","icon-tile")).click(e);this.btn_tile.push(s),"list"==t.viewstyle&&s.removeClass("l-btn-disabled"),$.data(s.get(0),"data",{object:this}),a.append(i),a.append(s)}$(t.pagination.pageInfo1).append(a)}},toggleViewStyle:function(t){this.view.options;if("tile"==t){for(var a=0;a<this.btn_list.length;a++)this.btn_list[a].removeClass("l-btn-disabled");for(var a=0;a<this.btn_tile.length;a++)this.btn_tile[a].addClass("l-btn-disabled");isNotEmpty(this.list_bodyDiv)&&this.list_bodyDiv.hide(),isNotEmpty(this.tile_bodyDiv)&&this.tile_bodyDiv.show()}else{for(var a=0;a<this.btn_list.length;a++)this.btn_list[a].addClass("l-btn-disabled");for(var a=0;a<this.btn_tile.length;a++)this.btn_tile[a].removeClass("l-btn-disabled");isNotEmpty(this.list_bodyDiv)&&this.tile_bodyDiv.hide(),isNotEmpty(this.list_bodyDiv)&&this.list_bodyDiv.show()}},renderListBody:function(){var t=this.view.options,a=$("<div class='dlv-wrap'/>");if(t.maxHeight>0?a.css({"max-height":t.maxHeight,"overflow-y":"scroll"}):a.css({"overflow-y":"hidden"}),t.minHeight>0&&a.css({"min-height":t.minHeight}),this.bodyTable=$('<table class="dlv-body" cellpadding="0" cellspacing="0" style="width:100%"/>'),t.maxHeight>0&&this.bodyTable.css({"table-layout":"fixed"}),this.skipRows=0,isNotEmpty(t.header)&&0==t.header);else{var e=this.renderHeader();if(t.maxHeight>0)this.view.append(e);else{var i=e.find("tr");this.skipRows=i.length,this.bodyTable.append(i)}}return a.append(this.bodyTable),a},renderTileBody:function(){var t=this.view.options,a=$("<div />");return t.minHeight>0&&a.css({"min-height":t.minHeight}),a},render:function(){var t=this.view.options;if(this.view.addClass("dlv"),inArray(t.viewstyles,"list")){var a=this.renderListBody();"tile"==t.viewstyle&&a.hide(),this.list_bodyDiv=a,this.view.append(a)}if(inArray(t.viewstyles,"tile")){var a=this.renderTileBody();"list"==t.viewstyle&&a.hide(),this.tile_bodyDiv=a,this.view.append(a)}this.renderPager()},clearBody:function(){var t=this.view.options;inArray(t.viewstyles,"list")&&(0==this.skipRows?this.bodyTable.find("tr").remove():this.bodyTable.find("tr:gt("+(this.skipRows-1)+")").remove()),inArray(t.viewstyles,"tile")&&this.tile_bodyDiv.empty()},onSelectPage:function(t){this.load(t.pageNumber,t.pageSize)},updatePage:function(t){var a=this.view.options,e=!0;if(isNotEmpty(t.pageSize)&&-1!=$.inArray(t.pageSize,a.pagination.pageList)){a.pagination.pageSize=t.pageSize;for(var i=0;i<2;i++)isNotEmpty(a.pagination.object.pageList[i])&&a.pagination.object.pageList[i].val(t.pageSize)}isNotEmpty(t.totalSize)&&(e=!1,a.pagination.totalSize=t.totalSize),a.pagination.lastPage=a.pagination.totalSize%a.pagination.pageSize;var s=(a.pagination.totalSize-a.pagination.lastPage)/a.pagination.pageSize;a.pagination.totalPage=s+(0==a.pagination.lastPage?0:1),a.pagination.totalPage=0==a.pagination.totalPage?1:a.pagination.totalPage,isNotEmpty(t.pageNumber)&&(a.pagination.pageNumber=t.pageNumber),a.pagination.pageNumber<1&&(a.pagination.pageNumber=1),a.pagination.pageNumber>a.pagination.totalPage&&(a.pagination.pageNumber=a.pagination.totalPage);for(var i=0;i<2;i++)1==a.pagination.pageNumber?(isNotEmpty(a.pagination.object.page_first[i])&&a.pagination.object.page_first[i].addClass("l-btn-disabled"),isNotEmpty(a.pagination.object.page_prev[i])&&a.pagination.object.page_prev[i].addClass("l-btn-disabled")):(isNotEmpty(a.pagination.object.page_first[i])&&a.pagination.object.page_first[i].removeClass("l-btn-disabled"),isNotEmpty(a.pagination.object.page_prev[i])&&a.pagination.object.page_prev[i].removeClass("l-btn-disabled")),a.pagination.pageNumber==a.pagination.totalPage?(isNotEmpty(a.pagination.object.page_next[i])&&a.pagination.object.page_next[i].addClass("l-btn-disabled"),isNotEmpty(a.pagination.object.page_last[i])&&a.pagination.object.page_last[i].addClass("l-btn-disabled")):(isNotEmpty(a.pagination.object.page_next[i])&&a.pagination.object.page_next[i].removeClass("l-btn-disabled"),isNotEmpty(a.pagination.object.page_last[i])&&a.pagination.object.page_last[i].removeClass("l-btn-disabled")),isNotEmpty(a.pagination.object.totalPage[i])&&a.pagination.object.totalPage[i].html($.fn.datalistview.defaults.totalPage.replace("{totalPage}",a.pagination.totalPage)),isNotEmpty(a.pagination.object.pageNo[i])&&a.pagination.object.pageNo[i].val(a.pagination.pageNumber);1==e&&this.onSelectPage(a.pagination)},renderTopPageDiv:function(t){var a=this.view.options,e=$("<div class='pagination dlv-pager'/>"),i=$('<table cellspacing="0" cellpadding="0" border="0"/>'),s=$("<tr/>");i.append(s),isNotEmpty(a.pagination.object)||(a.pagination.object={});var n;n=$("<td>");var o=[10,20,30,50];isNotEmpty(a.pagination.pageList)&&(o=a.pagination.pageList),a.pagination.pageList=o;var l=function(t){$.data(this,"data").object.updatePage({pageSize:parseInt($(this).val())})},d=$("<select class='pagination-page-list'/>").change(l);$.data(d.get(0),"data",{object:this});for(var p=0;p<o.length;p++)d.append($("<option value='"+o[p]+"'>"+o[p]+"</option>"));var r=20;isNotEmpty(a.pagination.pageSize)&&(r=a.pagination.pageSize),a.pagination.pageSize=r,d.val(r),o.length<=1&&n.hide(),n.append(d),s.append(n);var c="<td><div class='pagination-btn-separator'/></td>",v=$(c);v.length<=1&&v.hide(),s.append(v),isNotEmpty(a.pagination.object.pageList)?a.pagination.object.pageList.push(d):a.pagination.object.pageList=[d],n=$("<td/>");var l=function(t){if(!$(this).hasClass("l-btn-disabled")){$.data(this,"data").object.updatePage({pageNumber:1})}},g=$(btn_html.replace("$btn_action","pagination-first")).click(l);n.append(g),s.append(n),$.data(g.get(0),"data",{object:this}),isNotEmpty(a.pagination.object.page_first)?a.pagination.object.page_first.push(g):a.pagination.object.page_first=[g],n=$("<td/>");var l=function(t){if(!$(this).hasClass("l-btn-disabled")){var e=$.data(this,"data"),i=a.pagination.pageNumber-1;e.object.updatePage({pageNumber:i>0?i:1})}},h=$(btn_html.replace("$btn_action","pagination-prev")).click(l);n.append(h),s.append(n),$.data(h.get(0),"data",{object:this}),isNotEmpty(a.pagination.object.page_prev)?a.pagination.object.page_prev.push(h):a.pagination.object.page_prev=[h],s.append(c),s.append('<td><span style="padding-left:6px;">'+$.fn.datalistview.defaults.pagePrev+"</span></td>"),n=$("<td/>");var l=function(t){if(13==t.keyCode){var a=$(this).attr("oldValue"),e=parseInt($(this).val());if(e>=0&&e!=a){$.data(this,"data").object.updatePage({pageNumber:e})}$(this).attr("oldValue",e)}},u=$('<input type="text" size="3" value="1" class="pagination-num">').keypress(l);n.append(u),s.append(n),$.data(u.get(0),"data",{object:this}),isNotEmpty(a.pagination.object.pageNo)?a.pagination.object.pageNo.push(u):a.pagination.object.pageNo=[u],n=$("<td/>");var f=$("<span style='padding-right:6px;'/>");f.html($.fn.datalistview.defaults.totalPage.replace("{totalPage}",1)),n.append(f),s.append(n),isNotEmpty(a.pagination.object.totalPage)?a.pagination.object.totalPage.push(f):a.pagination.object.totalPage=[f],s.append(c),n=$("<td/>");var l=function(t){if(!$(this).hasClass("l-btn-disabled")){var e=$.data(this,"data"),i=a.pagination.pageNumber+1;e.object.updatePage({pageNumber:i>a.pagination.totalPage?a.pagination.totalPage:i})}},b=$(btn_html.replace("$btn_action","pagination-next")).click(l);n.append(b),s.append(n),$.data(b.get(0),"data",{object:this}),isNotEmpty(a.pagination.object.page_next)?a.pagination.object.page_next.push(b):a.pagination.object.page_next=[b],n=$("<td/>");var m=$(btn_html.replace("$btn_action","pagination-last")).click(function(t){if(!$(this).hasClass("l-btn-disabled")){$.data(this,"data").object.updatePage({pageNumber:a.pagination.totalPage})}});n.append(m),s.append(n),$.data(m.get(0),"data",{object:this}),isNotEmpty(a.pagination.object.page_last)?a.pagination.object.page_last.push(m):a.pagination.object.page_last=[m],s.append(c),n=$("<td/>");var w=$(btn_html.replace("$btn_action","pagination-load")).click(function(t){if(!$(this).hasClass("l-btn-disabled")){var a=$.data(this,"data");a.object.clean_cache(),a.object.reload(!0)}});if(n.append(w),s.append(n),$.data(w.get(0),"data",{object:this}),isNotEmpty(a.pagination.object.page_load)?a.pagination.object.page_load.push(w):a.pagination.object.page_load=[w],isObject(a.pagination.buttons)){var y=a.pagination.buttons.length;if(y>0){s.append(c);for(var j=0;j<y;j++){var N=a.pagination.buttons[j];n=$("<td/>");var S=$("<a href='javascript:void(0);' class='l-btn l-btn-plain'>"+N.text+"</a>").click(function(t){t.stopPropagation(),$.data(this,"data").handler.apply(this,[])});$.data(S.get(0),"data",N),isNotEmpty(N.title)&&S.attr("title",N.title),isNotEmpty(N.iconCls)&&S.attr("iconCls",N.iconCls),n.append(S),s.append(n)}}}return e.append(i),this.updatePage({totalSize:0}),e},getPagination:function(){return this.view.options.pagination},getSource:function(){return $.data(this.view.get(0),"data").source},selected:function(){return $.data(this.view.get(0),"data").selected},update:function(t,a){this.view.options[t]=a},clean_cache:function(){this.view.options.pagination.clean_cache=1},reset_offset:function(){this.view.options.pagination.pageNumber=1},reload:function(t){var a=this.view.options;$.data(this.view.get(0),"data").selected=[],this.updateSelection(),!0===t&&(a.pagination.totalSize=0,a.pagination.totalPage=0),this.load(a.pagination.pageNumber,a.pagination.pageSize)},loading:function(t){var a=this.view.options;if(function(t){for(var e=0;e<2;e++){var i=a.pagination.object.page_load[e];isNotEmpty(i)&&(t?(i.addClass("l-btn-disabled"),i.find("span>span>span").removeClass("pagination-load").addClass("pagination-loading")):(i.removeClass("l-btn-disabled"),i.find("span>span>span").removeClass("pagination-loading").addClass("pagination-load")))}}(t),t)if($(document.body).css({cursor:"wait"}),isNotEmpty(this.loadingDiv)&&this.loadingDiv.remove(),!1===a.progress);else{var e=getViewportInfo(),i=$("<div class='waiting_wrap'/>");i.css({"z-index":9903,left:(e.w-80)/2,top:(e.h-50)/2});var s="<table cellpadding='0' cellspacing='0' style='width:100%;vertical-align:top'><tr>";s+="<td style='width: 39px'><div class='waiting'/></td>",s+="<td style='padding: 2px;padding-left: 4px'><span style='font-size: 12px;'>"+$.fn.datalistview.defaults.infoLoading+"</span></td>",s+="</tr></table>",i.html(s),$(document.body).append(i),this.loadingDiv=i}else $(document.body).css({cursor:"default"}),isNotEmpty(this.loadingDiv)&&this.loadingDiv.remove(),this.loadingDiv=null},load:function(t,a){var e=this.view.options,i=[];if(isNotEmpty(this.filterTR)&&(this.filterTR.find("input").each(function(t,a){var e=$(this).attr("filterName"),s=$(this).val();""!=s&&i.push({id:e,value:s})}),this.filterTR.find("select").each(function(t,a){var e=$(this).attr("filterName"),s=$(this).val();""!=s&&i.push({id:e,value:s})})),this.loading(!0),isFunction(e.source)){var s={offset:(t-1)*a,pageSize:a,totalPage:e.pagination.totalPage,totalSize:e.pagination.totalSize,sortSet:e.sortSet,filterSet:i,clean_cache:e.pagination.clean_cache};e.useHash&&this.updateHash(s);var n=e.source.apply(this,[s]);null!=n&&this.setSource(n)}else isObject(e.source)&&this.setSource(e.source)},updateHash:function(t){if(isNotEmpty($.toJSON)){for(var a=[],e=0;e<t.sortSet.length;e++)a.push([t.sortSet[e].id,"desc"==t.sortSet[e].sort?0:1]);for(var i=[],e=0;e<t.filterSet.length;e++)i.push([t.filterSet[e].id,t.filterSet[e].value]);var s=[88,[t.offset,t.pageSize,t.totalPage,t.totalSize],a,i,99];setHashKey("dlv",base64encode(utf16to8($.toJSON(s))))}},updateSelection:function(){var t=this.view.options,a=$.data(this.view.get(0),"data"),e=a.selected;this.onSelected(e);var i=$.fn.datalistview.defaults.infoMsg;!1!==t.canselect&&(i+=$.fn.datalistview.defaults.infoSel.replace("{selected}",e.length));var s=(t.pagination.pageNumber-1)*t.pagination.pageSize+1,n=t.pagination.pageNumber*t.pagination.pageSize;n=n>t.pagination.totalSize?t.pagination.totalSize:n;var o=i.replace("{from}",s).replace("{to}",n).replace("{total}",t.pagination.totalSize);isNotEmpty(this.view.infoDiv)&&this.view.infoDiv.html(o),isNotEmpty(this.view.infoDiv1)&&isString(t.pagination.pageDiv1)&&this.view.infoDiv1.html(o)},drawListview:function(source){var o=this.view.options;if(isNotEmpty(this.bodyTable)){var table=this.bodyTable,selected=data.selected;if(0==source.data.length){var colspan=1,cols=table.find("tr:eq(0)").children();cols.length>0&&(colspan=cols.length);var tr=$("<tr class='dlv-row' style='height: 60px'/>"),td=$('<td colspan="'+colspan+"\" class='dlv-cell' style='text-align:center'/>");td.html($.fn.datalistview.defaults.infoEmptySource),tr.append(td),table.append(tr)}else for(var i=0;i<source.data.length;i++){var f=function(t){var a=$.data(this,"data");if(!1!==a.object.view.options.canselect){var e=$.data(a.object.view.get(0),"data"),i=e.selected,s=a.value[e.source.keyid];isNotEmpty(s.value)&&(s=s.value);var n=s;if(1==a.object.view.options.multi){$(this).toggleClass("dlv-row-selected"),i=$.grep(i,function(t,a){var i=t[e.source.keyid];return isNotEmpty(i.value)&&(i=i.value),i!=n});var o=function(t,a){var e=$(t).find("input");e.length>0&&(e.get(0).checked=a)};$(this).hasClass("dlv-row-selected")?(i.push(a.value),o(this,!0)):o(this,!1)}else $(e.view).find(".dlv-row-selected").removeClass("dlv-row-selected"),$(this).toggleClass("dlv-row-selected"),i=$(this).hasClass("dlv-row-selected")?[a.value]:[];e.selected=i,a.object.updateSelection()}},tr=$("<tr class='dlv-row'/>").addClass("dlv-row-"+i%2).mouseover(function(t){$(this).addClass("dlv-row-over")}).mouseout(function(t){$(this).removeClass("dlv-row-over")}).dblclick(function(t){var a=$.data(this,"data");a.object.onRowDblClick([a.value])}).click(f);isNotEmpty(o.rowHeight)&&tr.css({height:o.rowHeight});var td;if(null!=o.rowCount){td=$("<td class='dlv-cell'/>").css({width:o.rowCount.width,"text-align":o.rowCount.align}),isNotEmpty(o.rowCount.valign)&&td.css({"vertical-align":o.rowCount.valign});var idiv=$("<div/>");idiv.css({width:"100%","text-align":o.rowCount.align}),td.append(idiv);var startid=(o.pagination.pageNumber-1)*o.pagination.pageSize;if(startid=startid<0?0:startid,idiv.html("<span>"+(startid+i+1)+"</span>"),tr.append(td),!1!==o.canselect&&1==o.multi){var chkbox=$("<input type='checkbox'/>").css({padding:0,margin:1});idiv.prepend(chkbox)}}var adata=source.data[i],cdata=adata[source.keyid];if(isNotEmpty(cdata.value)&&(cdata=cdata.value),!1!==o.canselect){for(var exists=!1,idx=0;idx<selected.length;idx++){var bdata=selected[idx][source.keyid];if(isNotEmpty(bdata.value)&&(bdata=bdata.value),bdata==cdata){exists=!0;break}}1==exists&&(1==o.multi&&tr.find("input").length>0&&(tr.find("input").get(0).checked=!0),tr.addClass("dlv-row-selected"))}for(var j=0;j<o.columns.length;j++){var td=$("<td class='dlv-cell'/>");isNotEmpty(o.columns[j].valign)&&td.css({"vertical-align":o.columns[j].valign});var idiv=$("<div />");idiv.css({"text-align":o.columns[j].align}),td.append(idiv),isNotEmpty(o.columns[j].width)&&(idiv.css({width:"100%"}),td.css({width:o.columns[j].width}));var column=o.columns[j];if(isNotEmpty(adata[column.id])){var cdata=adata[column.id],text="";if(isNotEmpty(column.formatter)){var func=column.formatter;if(!isFunction(func))try{func=eval(func)}catch(t){func=null}isNotEmpty(func)&&(text=func.apply(this,[i,source,column])),isString(text)?idiv.html(text):idiv.append(text)}else text=cdata,isNotEmpty(cdata.value)&&(text=cdata.value),idiv.html(text)}tr.append(td)}table.append(tr),$.data(tr.get(0),"data",{index:i,value:source.data[i],object:this}),isFunction(this.contextmenu)&&tr.bind("contextmenu",function(t){t.preventDefault(),t.stopPropagation();var a=$.data(this,"data");t.data=a,a.object.contextmenu.apply(this,[t])}),this.onAddRow(table,tr,source.data[i])}}},drawTileview:function(source){var o=this.view.options,tileBody=$("<div class='tileBody'/>");if(0==source.data.length){var table=$("<table style='width:100%' />"),tr=$("<tr class='dlv-row' style='height: 60px'/>"),td=$("<td class='dlv-cell' style='text-align:center'/>");td.html($.fn.datalistview.defaults.infoEmptySource),tr.append(td),table.append(tr),tileBody.append(table)}else{for(var ul=$("<ul class='dlv_body'/>"),i=0;i<source.data.length;i++){var adata=source.data[i],cdata=adata[source.keyid];isNotEmpty(cdata.value)&&(cdata=cdata.value);var f=function(t){var a=$.data(this,"data"),e=$.data(a.object.view.get(0),"data");if(!1!==a.object.view.options.canselect){var i=e.selected,s=a.value[e.source.keyid];isNotEmpty(s.value)&&(s=s.value);var n=s;1==a.object.view.options.multi?($(this).toggleClass("dlv-row-selected"),i=$.grep(i,function(t,a){var i=t[e.source.keyid];return isNotEmpty(i.value)&&(i=i.value),i!=n}),$(this).hasClass("dlv-row-selected")?(i.push(a.value),$(this).find("input").get(0).checked=!0):$(this).find("input").get(0).checked=!1):($(e.view).find(".dlv-row-selected").removeClass("dlv-row-selected"),$(this).toggleClass("dlv-row-selected"),i=$(this).hasClass("dlv-row-selected")?[a.value]:[]),e.selected=i,a.object.updateSelection()}},li=$("<li/>"),idiv=$("<div class='thumb'/>").mouseover(function(t){$(this).addClass("dlv-row-over")}).mouseout(function(t){$(this).removeClass("dlv-row-over")}).dblclick(function(t){var a=$.data(this,"data");a.object.onRowDblClick([a.value])}).click(f);if(isNotEmpty(o.tiles)&&(isNotEmpty(o.tiles.width)&&idiv.css({width:o.tiles.width}),isNotEmpty(o.tiles.height)&&idiv.css({height:o.tiles.height})),isFunction(this.contextmenu)&&idiv.bind("contextmenu",function(t){t.preventDefault(),t.stopPropagation();var a=$.data(this,"data");t.data=a,a.object.contextmenu.apply(this,[t])}),isNotEmpty(o.formatter)){var func=o.formatter;if(!isFunction(func))try{func=eval(func)}catch(t){func=null}isNotEmpty(func)&&(text=func.apply(this,[i,source])),isString(text)?idiv.html(text):idiv.append(text)}else text=cdata,isNotEmpty(cdata.value)&&(text=cdata.value),idiv.html(text);li.append(idiv),$.data(idiv.get(0),"data",{index:i,value:source.data[i],object:this}),ul.append(li)}tileBody.append(ul)}this.tile_bodyDiv.append(tileBody)},setSource:function(t){var a=this.view.options;if(this.clearBody(),isObject(t.data)){$.data(this.view.get(0),"data").source=t,this.updatePage({totalSize:t.total})}else alert("数据格式错误！");inArray(a.viewstyles,"list")&&this.drawListview(t),inArray(a.viewstyles,"tile")&&this.drawTileview(t),this.updateSelection(),this.loading(!1)},onSelected:function(t){},onRowDblClick:function(t){},onAddRow:function(t,a,e){var i=this.view.options;if(isFunction(i.onDetailInfo)){var s=function(t){t.stopPropagation();var a=$.data(this,"data");if(1==$(this).hasClass("icon-add")){if(isNotEmpty(a.view.options.foldInfo)&&1==a.view.options.foldInfo)for(var e=$.data(a.view.get(0),"info_tr"),i=0;i<e.length;i++)e[i][0].removeClass("icon-remove").addClass("icon-add"),e[i][1].hide();a.tr.show(),$(this).removeClass("icon-add").addClass("icon-remove")}else a.tr.hide(),$(this).removeClass("icon-remove").addClass("icon-add");a.view.options.onDetailInfo.apply(a.panel,[a.data,"true"==a.panel.attr("opened")]),a.panel.attr("opened","true")},n=$("<div class='icon-add'/>").css({width:16,height:16}).click(s),o=$("<div class='detail_info_btn'/>").attr("title",$.fn.datalistview.defaults.toggleDetail).append(n);a.find("td:eq(0)").prepend(o);var l=a.find("td").length,d=$("<tr class='detail_info_tr' style='display:none'/>"),p=$("<td colspan='"+l+"'/>"),r=$("<div class='detail_info_panel'/>");p.append(r),d.append(p),t.append(d);var c=$.data(this.view.get(0),"info_tr");isNotEmpty(c)||(c=[]),c.push([n,d]),$.data(this.view.get(0),"info_tr",c),$.data(n.get(0),"data",{panel:r,tr:d,view:this.view,data:e})}isFunction(i.onAddRow)&&i.onAddRow.apply(t,a,e)}},isString(options)){var data=$.data(this.get(0),"data");if(data.view.refresh=!1,"reload"==options&&(!0===value&&(data.view.refresh=!0),value=null),isFunction(data.view.methods[options])){var f=data.view.methods[options];return isNotEmpty(value)?f.apply(data.view.methods,value):f.apply(data.view.methods)}return null}if(this.options=$.extend({multi:!1,canselect:!0,useHash:!0,header:!0,viewstyles:["list"],viewstyle:"list",pagination:{},maxHeight:0,minHeight:0,scrollWidth:14,source:{},sortSet:[],methods:{},rowCount:{width:$.fn.datalistview.defaults.w_rowCount,align:"center",title:$.fn.datalistview.defaults.rowTitle},onDetailInfo:null},options),1==this.options.useHash){var hval=getHashKey("dlv");if(""!=hval)try{if(eval("var qry ="+utf8to16(base64decode(hval))),88===qry[0]&&99===qry[qry.length-1]){for(var pst=qry[1],srt=qry[2],flt=qry[3],sortSet=[],i=0;i<srt.length;i++)sortSet.push({id:srt[i][0],sort:0==srt[i][1]?"desc":"asc"});this.options.sortSet=sortSet;for(var filterSet=this.options.filterSet,i=0;i<flt.length;i++){var iid=flt[i][0];filterSet.hasOwnProperty(iid)&&(filterSet[iid].value=flt[i][1])}this.options.filterSet=filterSet}}catch(t){}}this.methods=$.extend(this.methods,this.options.methods),this.methods.options=this.options,this.methods.render();var data=$.data(this.get(0),"data",{selected:[],view:this});this.methods.reload()},opt={datalistview:func};$.extend($.fn,opt),$.fn.datalistview.defaults={w_rowCount:60,filterText:"筛选",toggleDetail:"展开详细",rowTitle:"编号",pagePrev:"第",totalPage:"共 {totalPage} 页",infoMsg:"显示第 {from} 到 {to} 条，共 {total} 条记录",infoSel:"，已选择 {selected} 条",infoLoading:"数据加载中，请稍候...",infoEmptySource:"没有记录！"}}(jQuery);